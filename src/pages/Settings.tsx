import { useState, useEffect } from 'react'; import { Settings as SetIcon, Building2, Bell, Database, Save, Download, Upload, Clock } from 'lucide-react'; import { toast } from 'sonner'; export default function Settings() { const [s, setS] = useState<any>({ name: 'المكتب', owner: 'المدير', n: { s: true, f: true, days: 1 } }); useEffect(() => { try { const v = localStorage.getItem('office_settings'); if (v) { const p = JSON.parse(v); setS({ ...s, ...p, n: p.n || { s: true, f: true, days: 1 } }); } } catch (e) { console.error(e); } }, []); const save = (e: any) => { e.preventDefault(); localStorage.setItem('office_settings', JSON.stringify(s)); toast.success('تم حفظ الإعدادات بنجاح'); }; const exp = () => { const d = { s, u: localStorage.getItem('lawyer_users'), c: localStorage.getItem('lawyer_cases'), cl: localStorage.getItem('lawyer_clients') }; const b = new Blob([JSON.stringify(d)], { type: 'application/json' }); const a = document.createElement('a'); a.href = URL.createObjectURL(b); a.download = 'backup.json'; a.click(); toast.success('تم تصدير النسخة'); }; const imp = (e: any) => { const f = e.target.files[0]; if (!f) return; const r = new FileReader(); r.onload = (ev: any) => { try { const d = JSON.parse(ev.target.result); if (d.u) localStorage.setItem('lawyer_users', d.u); if (d.c) localStorage.setItem('lawyer_cases', d.c); if (d.cl) localStorage.setItem('lawyer_clients', d.cl); if (d.s) { localStorage.setItem('office_settings', JSON.stringify(d.s)); setS(d.s); } toast.success('تمت الاستعادة'); setTimeout(() => window.location.reload(), 500); } catch { toast.error('ملف غير صالح'); } }; r.readAsText(f); }; return ( <div className="p-4 space-y-6 text-right font-arabic" dir="rtl"> <div className="flex justify-between items-center bg-white p-6 rounded-2xl border shadow-sm"> <div><h1 className="text-2xl font-bold text-slate-800">إعدادات النظام</h1><p className="text-xs text-slate-400 font-bold">تخصيص الهوية، التنبيهات، والنسخ الاحتياطي</p></div> <SetIcon className="w-8 h-8 text-amber-500" /> </div> <form onSubmit={save} className="grid grid-cols-1 lg:grid-cols-3 gap-6"> <div className="lg:col-span-2 space-y-6"> <div className="bg-white p-5 rounded-xl border space-y-4 shadow-sm"> <h2 className="font-bold flex items-center gap-2 border-b pb-2 text-slate-700"><Building2 className="w-4 h-4 text-amber-500" /> الهوية الرسمية</h2> <div className="grid grid-cols-2 gap-4"> <div><label className="text-[10px] font-bold text-slate-400">اسم المكتب</label><input className="w-full p-2.5 border rounded-lg text-sm font-bold outline-none focus:border-amber-500" value={s?.name} onChange={e => setS({...s, name: e.target.value})} /></div> <div><label className="text-[10px] font-bold text-slate-400">المحامي المسؤول</label><input className="w-full p-2.5 border rounded-lg text-sm font-bold outline-none focus:border-amber-500" value={s?.owner} onChange={e => setS({...s, owner: e.target.value})} /></div> </div> </div> <div className="bg-white p-5 rounded-xl border space-y-4 shadow-sm"> <h2 className="font-bold flex items-center gap-2 border-b pb-2 text-slate-700"><Bell className="w-4 h-4 text-amber-500" /> جدولة التنبيهات الذكية</h2> <div className="space-y-4"> <div className="flex items-center justify-between p-3 bg-slate-50 rounded-xl"> <div className="flex items-center gap-3"><Clock className="w-5 h-5 text-amber-500" /> <span className="text-sm font-bold text-slate-600">تنبيه قبل الموعد بـ :</span></div> <div className="flex items-center gap-2"> <select className="p-2 border rounded-lg text-xs font-bold outline-none bg-white" value={s?.n?.days} onChange={e => setS({...s, n: {...s.n, days: parseInt(e.target.value)}})}> <option value="1">يوم واحد</option> <option value="2">يومين</option> <option value="3">3 أيام</option> <option value="7">أسبوع (7 أيام)</option> </select> </div> </div> <div className="flex justify-between items-center px-3 py-2"> <span className="text-xs font-bold text-slate-500">تفعيل تنبيهات المالية والجلسات</span> <input type="checkbox" className="w-5 h-5 accent-amber-500" checked={s?.n?.s} onChange={e => setS({...s, n: {...s.n, s: e.target.checked}})} /> </div> </div> </div> </div> <div className="space-y-6"> <div className="bg-slate-900 text-white p-6 rounded-2xl space-y-4 shadow-xl border-b-4 border-amber-500"> <div className="flex items-center gap-2 border-b border-white/10 pb-3"><Database className="w-5 h-5 text-amber-500" /> <h2 className="font-bold text-sm text-right">الأمان والنسخ</h2></div> <button type="button" onClick={exp} className="w-full py-3 bg-amber-500 text-slate-900 rounded-xl font-black text-xs flex items-center justify-center gap-2 hover:bg-amber-400 transition-all"><Download className="w-4 h-4" /> حفظ نسخة احتياطية</button> <label className="w-full py-3 bg-white/5 border border-white/10 rounded-xl font-bold text-xs flex items-center justify-center gap-2 cursor-pointer hover:bg-white/10 transition-all"><Upload className="w-4 h-4 text-amber-500" /> استعادة بيانات <input type="file" className="hidden" accept=".json" onChange={imp} /></label> </div> <button type="submit" className="w-full bg-slate-800 text-white py-4 rounded-2xl font-black shadow-lg hover:bg-slate-700 transition-all flex items-center justify-center gap-2 border-b-4 border-slate-950"><Save className="w-5 h-5 text-amber-500" /> حفظ الإعدادات</button> </div> </form> </div> ); }