import { Briefcase, Users, Calendar, DollarSign, AlertTriangle, BellRing } from 'lucide-react'; import { StatCard } from '@/components/dashboard/StatCard'; import { UpcomingSessions } from '@/components/dashboard/UpcomingSessions'; import { RecentCases } from '@/components/dashboard/RecentCases'; import { QuickActions } from '@/components/dashboard/QuickActions'; import { FinanceChart } from '@/components/dashboard/FinanceChart'; import { useState, useEffect } from 'react'; export default function Dashboard() { const [d, setD] = useState<any>({ u: null, cases: [], clients: [], alerts: [], finance: 0, today: 0 }); useEffect(() => { const user = JSON.parse(localStorage.getItem('current_lawyer_user') || '{}'); const cases = JSON.parse(localStorage.getItem('lawyer_cases') || '[]'); const clients = JSON.parse(localStorage.getItem('lawyer_clients') || '[]'); const trans = JSON.parse(localStorage.getItem('lawyer_transactions') || '[]'); const sessArr = JSON.parse(localStorage.getItem('lawyer_sessions') || '[]'); const settings = JSON.parse(localStorage.getItem('office_settings') || '{"n":{"days":1}}'); const now = new Date(); now.setHours(0,0,0,0); const todayStr = new Date().toISOString().split('T')[0]; const allSessDates = [...cases.map((c:any)=>({d:c.nextSession, t:c.title})), ...sessArr.map((s:any)=>({d:s.date, t:s.caseTitle}))]; const upcoming = allSessDates.filter((s: any) => { if (!s.d || s.d === "لم يحدد بعد") return false; const sDate = new Date(s.d); sDate.setHours(0,0,0,0); const diff = Math.ceil((sDate.getTime() - now.getTime()) / 86400000); return diff >= 0 && diff <= (settings.n?.days || 1); }); const todaySessCount = allSessDates.filter((s: any) => s.d === todayStr).length; const totalRem = trans.reduce((acc: number, t: any) => acc + (Number(t.remaining) || 0), 0); setD({ u: user, cases, clients, alerts: upcoming, finance: totalRem, today: todaySessCount }); }, []); return ( <div className="space-y-6 text-right font-arabic" dir="rtl"> <div className="page-header flex justify-between items-center bg-white p-4 rounded-2xl border shadow-sm"> <div><h1 className="text-2xl font-black text-slate-800">لوحة التحكم</h1><p className="text-muted-foreground mt-1 font-bold italic text-sm">مرحباً بك، {d.u?.name || 'أستاذنا'}</p></div> <div className="text-left bg-slate-50 p-2 rounded-xl border text-[10px] font-black text-green-600">متصل الآن <span className="inline-block w-2 h-2 bg-green-500 rounded-full animate-ping"></span></div> </div> {d.alerts.length > 0 && ( <div className="bg-amber-50 border-2 border-amber-200 p-4 rounded-2xl flex items-center justify-between"> <div className="flex items-center gap-3"><div className="bg-amber-500 p-2 rounded-lg text-white"><BellRing className="w-5 h-5" /></div><div><h3 className="font-black text-amber-900 text-sm">تنبيه مواعيد!</h3><p className="text-xs text-amber-700 font-bold">لديك {d.alerts.length} جلسات قريبة مسجلة.</p></div></div> <button onClick={() => window.location.href='/mohamy/sessions'} className="bg-amber-600 text-white px-4 py-1.5 rounded-xl text-xs font-black">عرض</button> </div> )} <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 gap-4"> <StatCard title="إجمالي القضايا" value={d.cases.length} icon={Briefcase} variant="primary" /> <StatCard title="القضايا النشطة" value={d.cases.filter((c:any)=> c.status === 'active').length} icon={Briefcase} variant="gold" /> <StatCard title="العملاء" value={d.clients.length} icon={Users} /> <StatCard title="جلسات اليوم" value={d.today} icon={Calendar} variant="warning" /> <StatCard title="المستحقات" value={d.finance.toLocaleString()} subtitle="ج.م" icon={DollarSign} variant="danger" /> <StatCard title="تنبيهات" value={d.alerts.length} icon={AlertTriangle} /> </div> <QuickActions /> <div className="grid grid-cols-1 lg:grid-cols-2 gap-6"><UpcomingSessions /><FinanceChart /></div> <RecentCases /> </div> ); }