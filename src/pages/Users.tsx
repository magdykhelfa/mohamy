import { useState, useEffect } from 'react'; import { Plus, Search, Shield, Edit, Trash2, Mail, Key, X, Info } from 'lucide-react'; import { toast } from 'sonner'; export default function Users() { const [users, setUsers] = useState<any[]>([]); const [searchTerm, setSearchTerm] = useState(''); const [selectedRole, setSelectedRole] = useState('all'); const [isModalOpen, setIsModalOpen] = useState(false); const [currentUser, setCurrentUser] = useState<any>(null); useEffect(() => { const saved = JSON.parse(localStorage.getItem('lawyer_users') || '[]'); if (saved.length === 0) { const initial = [{ id: 1, name: 'admin', email: 'admin@law.com', phone: '01000', role: 'admin', status: 'active', password: '123' }]; localStorage.setItem('lawyer_users', JSON.stringify(initial)); setUsers(initial); } else setUsers(saved); }, []); const saveUser = (e: React.FormEvent<HTMLFormElement>) => { e.preventDefault(); const formData = new FormData(e.currentTarget); const userData = { id: currentUser?.id || Date.now(), name: formData.get('name'), email: formData.get('email'), phone: formData.get('phone'), role: formData.get('role'), status: formData.get('status'), password: formData.get('password') || '123' }; const updated = currentUser ? users.map(u => u.id === currentUser.id ? userData : u) : [...users, userData]; setUsers(updated); localStorage.setItem('lawyer_users', JSON.stringify(updated)); toast.success('تم الحفظ'); closeModal(); }; const closeModal = () => { setIsModalOpen(false); setCurrentUser(null); }; const deleteUser = (id: number) => { if (id === 1) return toast.error('لا يمكن حذف المدير'); if (confirm('متأكد؟')) { const updated = users.filter(u => u.id !== id); setUsers(updated); localStorage.setItem('lawyer_users', JSON.stringify(updated)); toast.error('تم الحذف'); } }; const filteredUsers = users.filter(u => (u.name?.includes(searchTerm) || u.email?.includes(searchTerm)) && (selectedRole === 'all' || u.role === selectedRole)); return ( <div className="space-y-6 text-right font-arabic" dir="rtl"> <div className="flex justify-between items-center bg-white p-6 rounded-2xl border shadow-sm"> <div><h1 className="text-2xl font-bold text-navy-dark">إدارة الفريق</h1><p className="text-sm text-muted-foreground font-bold">عرض وتعديل صلاحيات الوصول</p></div> <button onClick={() => setIsModalOpen(true)} className="bg-amber-500 text-white px-6 py-2.5 rounded-xl flex items-center gap-2 font-bold hover:scale-105 transition-all"><Plus className="w-5 h-5" /> إضافة موظف</button> </div> <div className="grid grid-cols-1 lg:grid-cols-4 gap-6"> <div className="lg:col-span-1 space-y-4"> <div className="bg-slate-900 text-white p-5 rounded-2xl shadow-lg border-b-4 border-amber-500"> <h3 className="font-bold flex items-center gap-2 mb-4 text-sm"><Info className="w-4 h-4 text-amber-500" /> دليل الصلاحيات</h3> <div className="space-y-3 text-[10px]"> <div className="p-2 bg-white/5 rounded-lg"><p className="text-amber-500 font-black">المدير:</p><p className="text-slate-300">تحكم كامل، مالية، موظفين، تقارير.</p></div> <div className="p-2 bg-white/5 rounded-lg"><p className="text-blue-400 font-black">المحامي:</p><p className="text-slate-300">قضايا، عملاء، جلسات (بدون مالية).</p></div> <div className="p-2 bg-white/5 rounded-lg"><p className="text-green-400 font-black">السكرتير:</p><p className="text-slate-300">عملاء، جلسات، تنبيهات (بدون قضايا).</p></div> </div> </div> <div className="bg-white p-4 rounded-2xl border space-y-3"> <input type="text" placeholder="بحث..." className="w-full p-2 border rounded-lg text-sm" value={searchTerm} onChange={(e) => setSearchTerm(e.target.value)} /> <select className="w-full p-2 border rounded-lg text-sm font-bold" value={selectedRole} onChange={(e) => setSelectedRole(e.target.value)}><option value="all">الكل</option><option value="admin">مدير</option><option value="lawyer">محامي</option><option value="secretary">سكرتير</option></select> </div> </div> <div className="lg:col-span-3 grid grid-cols-1 md:grid-cols-2 gap-4 h-fit"> {filteredUsers.map((user) => ( <div key={user.id} className="bg-white rounded-2xl border p-4 shadow-sm hover:border-amber-500/50 transition-all"> <div className="flex justify-between items-start"> <div className="flex items-center gap-3"><div className="w-10 h-10 rounded-full bg-slate-100 flex items-center justify-center font-bold">{user.name?.charAt(0)}</div><div><h3 className="font-bold text-sm">{user.name}</h3><span className="text-[9px] px-2 py-0.5 rounded-md bg-amber-100 text-amber-700 font-bold">{user.role}</span></div></div> <div className="flex gap-1"><button onClick={() => { setCurrentUser(user); setIsModalOpen(true); }} className="p-1.5 text-blue-500 hover:bg-blue-50 rounded-lg"><Edit className="w-4 h-4" /></button><button onClick={() => deleteUser(user.id)} className="p-1.5 text-red-400 hover:bg-red-50 rounded-lg"><Trash2 className="w-4 h-4" /></button></div> </div> <div className="mt-3 pt-3 border-t border-dashed flex items-center justify-between text-[10px] font-bold text-slate-500"> <div className="flex items-center gap-1"><Key className="w-3 h-3 text-amber-500" /> {user.password}</div> <div className={user.status === 'active' ? 'text-green-500' : 'text-red-500'}>{user.status === 'active' ? 'نشط' : 'معطل'}</div> </div> </div> ))} </div> </div> {isModalOpen && ( <div className="fixed inset-0 bg-black/40 backdrop-blur-sm z-50 flex items-center justify-center p-4"> <div className="bg-white rounded-2xl shadow-xl w-full max-w-md overflow-hidden"> <div className="bg-slate-900 p-4 flex justify-between items-center text-white font-bold text-sm"><h2>{currentUser ? 'تعديل بيانات' : 'إضافة موظف'}</h2><button onClick={closeModal}><X className="w-5 h-5" /></button></div> <form onSubmit={saveUser} className="p-6 space-y-4 text-right"> <div><label className="text-xs font-bold block mb-1">الاسم</label><input name="name" defaultValue={currentUser?.name} required className="w-full p-2.5 border rounded-xl text-sm" /></div> <div className="grid grid-cols-2 gap-4"> <div><label className="text-xs font-bold block mb-1">البريد</label><input name="email" type="email" defaultValue={currentUser?.email} className="w-full p-2.5 border rounded-xl text-sm" /></div> <div><label className="text-xs font-bold block mb-1">الهاتف</label><input name="phone" defaultValue={currentUser?.phone} className="w-full p-2.5 border rounded-xl text-sm" /></div> </div> <div><label className="text-xs font-bold block mb-1 text-amber-600">كلمة السر</label><input name="password" defaultValue={currentUser?.password || '123'} required className="w-full p-2.5 border-2 border-amber-500 rounded-xl font-black text-center" /></div> <div className="grid grid-cols-2 gap-4"> <div><label className="text-xs font-bold block mb-1">الوظيفة</label><select name="role" defaultValue={currentUser?.role || 'lawyer'} className="w-full p-2.5 border rounded-xl text-sm font-bold"><option value="admin">مدير</option><option value="lawyer">محامي</option><option value="secretary">سكرتير</option></select></div> <div><label className="text-xs font-bold block mb-1">الحالة</label><select name="status" defaultValue={currentUser?.status || 'active'} className="w-full p-2.5 border rounded-xl text-sm font-bold"><option value="active">نشط</option><option value="inactive">معطل</option></select></div> </div> <button type="submit" className="w-full bg-amber-500 text-white font-bold py-3 rounded-xl hover:bg-slate-900 transition-all">حفظ البيانات</button> </form> </div> </div> )} </div> ); }